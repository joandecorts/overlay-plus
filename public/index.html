<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Banners</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        #container {
            position: relative;
            width: 1920px;
            height: 1080px;
            background-color: #000;
            overflow: hidden;
        }
        #station-container {
            width: 100%;
            height: 100%;
        }
        #controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: flex;
            gap: 20px;
            align-items: center;
            z-index: 1000;
        }
        #prev-btn, #next-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        #prev-btn:hover, #next-btn:hover {
            background-color: #0056b3;
        }
        #station-counter {
            font-size: 14px;
            min-width: 60px;
            text-align: center;
        }
        #rotation-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        #rotation-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        #rotation-btn:hover {
            background-color: #1e7e34;
        }
        #rotation-speed {
            width: 100px;
        }
        #status {
            font-size: 12px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="station-container">
            <!-- El contingut de l'estació es carregarà aquí -->
        </div>
    </div>
    
    <div id="controls">
        <button id="prev-btn">◀ Anterior</button>
        <div id="station-counter">0/0</div>
        <button id="next-btn">Següent ▶</button>
        
        <div id="rotation-controls">
            <button id="rotation-btn">Aturar Rotació</button>
            <input type="range" id="rotation-speed" min="5" max="60" value="30">
            <span id="status">Rotant: 30s</span>
        </div>
    </div>

    <script>
        // Llista COMPLETA de tots els IDs d'estacions en ordre alfabètic
        const stationFilesList = [
            'index_WB.html', 'index_XY.html', 'index_U7.html', 'index_WK.html', 'index_WG.html', 
            'index_X3.html', 'index_Y4.html', 'index_UU.html', 'index_DN.html', 'index_XX.html', 
            'index_WW.html', 'index_VA.html', 'index_WU.html', 'index_X6.html', 'index_DJ.html', 
            'index_X4.html', 'index_D5.html', 'index_X8.html', 'index_YX.html', 'index_VB.html', 
            'index_W8.html', 'index_Z2.html', 'index_YT.html', 'index_Z1.html', 'index_YS.html', 
            'index_UP.html', 'index_Z9.html', 'index_X9.html', 'index_WX.html', 'index_WP.html', 
            'index_YU.html', 'index_XU.html', 'index_MQ.html', 'index_UN.html', 'index_DO.html', 
            'index_MS.html', 'index_XC.html', 'index_U4.html', 'index_C6.html', 'index_W1.html', 
            'index_Z5.html', 'index_C8.html', 'index_VQ.html', 'index_WZ.html', 'index_DP.html', 
            'index_UQ.html', 'index_VD.html', 'index_WJ.html', 'index_UH.html', 'index_DB.html', 
            'index_V8.html', 'index_CT.html', 'index_ZE.html', 'index_XL.html', 'index_D9.html', 
            'index_XM.html', 'index_UW.html', 'index_CE.html', 'index_VZ.html', 'index_Z7.html', 
            'index_X1.html', 'index_KP.html', 'index_DI.html', 'index_UO.html', 'index_XP.html', 
            'index_VH.html', 'index_XJ.html', 'index_UI.html', 'index_WC.html', 'index_YM.html', 
            'index_WV.html', 'index_MV.html', 'index_D8.html', 'index_DL.html', 'index_WO.html', 
            'index_DF.html', 'index_UM.html', 'index_XB.html', 'index_XA.html', 'index_YC.html', 
            'index_CR.html', 'index_KX.html', 'index_CD.html', 'index_UB.html', 'index_ZD.html', 
            'index_W9.html', 'index_VS.html', 'index_U9.html', 'index_UA.html', 'index_YD.html', 
            'index_US.html', 'index_CW.html', 'index_VO.html', 'index_YJ.html', 'index_WI.html', 
            'index_WT.html', 'index_Z3.html', 'index_D1.html', 'index_C9.html', 'index_YE.html', 
            'index_YV.html', 'index_YF.html', 'index_XI.html', 'index_CG.html', 'index_V4.html', 
            'index_WQ.html', 'index_WN.html', 'index_CY.html', 'index_Y5.html', 'index_MW.html', 
            'index_VY.html', 'index_DG.html', 'index_H1.html', 'index_W5.html', 'index_WA.html', 
            'index_YB.html', 'index_CJ.html', 'index_CC.html', 'index_UY.html', 'index_YP.html', 
            'index_J5.html', 'index_VC.html', 'index_KE.html', 'index_MR.html', 'index_XG.html', 
            'index_V5.html', 'index_VP.html', 'index_UF.html', 'index_X5.html', 'index_Y7.html', 
            'index_YQ.html', 'index_D6.html', 'index_XR.html', 'index_XK.html', 'index_YA.html', 
            'index_YH.html', 'index_VK.html', 'index_VU.html', 'index_YL.html', 'index_D4.html', 
            'index_XF.html', 'index_ZB.html', 'index_XV.html', 'index_M6.html', 'index_VV.html', 
            'index_WL.html', 'index_U3.html', 'index_CI.html', 'index_UK.html', 'index_U2.html', 
            'index_CP.html', 'index_YO.html', 'index_CL.html', 'index_XS.html', 'index_UJ.html', 
            'index_WM.html', 'index_Z6.html', 'index_XN.html', 'index_XT.html', 'index_XH.html', 
            'index_VX.html', 'index_XE.html', 'index_C7.html', 'index_YK.html', 'index_YG.html', 
            'index_Y6.html', 'index_DK.html', 'index_X7.html', 'index_XZ.html', 'index_UE.html', 
            'index_WR.html', 'index_XQ.html', 'index_UX.html', 'index_XD.html', 'index_ZC.html', 
            'index_D2.html', 'index_V1.html', 'index_D3.html', 'index_XO.html', 'index_YN.html', 
            'index_UG.html', 'index_WS.html', 'index_W4.html', 'index_CQ.html', 'index_VM.html', 
            'index_YR.html', 'index_DQ.html', 'index_D7.html', 'index_U6.html'
        ];

        let currentStationIndex = 0;
        let rotationInterval;
        let isRotating = true;
        let rotationSpeed = 30000; // 30 segons per defecte
        let availableStationsCount = 0; // Recompte REAL d'estacions disponibles

        // Elements DOM
        const stationContainer = document.getElementById('station-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const stationCounter = document.getElementById('station-counter');
        const rotationBtn = document.getElementById('rotation-btn');
        const rotationSpeedInput = document.getElementById('rotation-speed');
        const statusSpan = document.getElementById('status');

        // Funció per obtenir el recompte REAL del banner.html
        async function getAvailableStationsCount() {
            try {
                const response = await fetch('banner.html');
                if (response.ok) {
                    const html = await response.text();
                    
                    // Buscar el recompte d'estacions disponibles al banner.html
                    // Suposant que hi ha alguna indicació al banner.html del nombre d'estacions
                    // Si no hi ha, podem intentar trobar els links a les estacions
                    
                    // Intentem trobar tots els links que continguin 'index_' per estimar el recompte
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Buscar tots els elements que puguin contenir estacions
                    const links = doc.querySelectorAll('a[href*="index_"], [data-station*="index_"]');
                    const scripts = doc.querySelectorAll('script');
                    
                    let count = 0;
                    
                    // Mirar en els scripts per trobar informació del recompte
                    scripts.forEach(script => {
                        const text = script.textContent;
                        // Buscar patrons com "estacions: 35" o "total: 35"
                        const matches = text.match(/(estacions|total|count)\s*[:=]\s*(\d+)/i);
                        if (matches && matches[2]) {
                            count = parseInt(matches[2]);
                        }
                    });
                    
                    // Si no hem trobat al script, intentem estimar per links
                    if (count === 0 && links.length > 0) {
                        count = links.length;
                    }
                    
                    // Si encara no hem trobat, fem una estimació baixa
                    if (count === 0) {
                        console.log("No s'ha pogut determinar el recompte d'estacions disponibles, utilitzant estimació");
                        return 35; // Valor per defecte
                    }
                    
                    return count;
                }
            } catch (error) {
                console.log("No s'ha pogut llegir banner.html, utilitzant valor per defecte");
            }
            return 35; // Valor per defecte si no es pot determinar
        }

        // Funció per verificar si un fitxer existeix
        async function checkFileExists(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        // Funció per carregar el fitxer d'estació actual
        async function loadCurrentStation() {
            if (currentStationIndex >= 0 && currentStationIndex < stationFilesList.length) {
                const stationFile = stationFilesList[currentStationIndex];
                
                try {
                    const response = await fetch(stationFile);
                    if (response.ok) {
                        const html = await response.text();
                        stationContainer.innerHTML = html;
                        updateStationCounter();
                    } else {
                        // Si el fitxer no existeix, passar a la següent estació
                        console.log(`Fitxer ${stationFile} no trobat, passant a la següent estació`);
                        await moveToNextAvailableStation();
                    }
                } catch (error) {
                    console.log(`Error carregant ${stationFile}, passant a la següent estació`);
                    await moveToNextAvailableStation();
                }
            }
        }

        // Funció per trobar la següent estació disponible
        async function moveToNextAvailableStation() {
            const originalIndex = currentStationIndex;
            let attempts = 0;
            
            do {
                currentStationIndex = (currentStationIndex + 1) % stationFilesList.length;
                attempts++;
                
                // Si hem donat la volta completa, aturem
                if (attempts >= stationFilesList.length) {
                    console.log("No s'ha trobat cap fitxer vàlid");
                    stationContainer.innerHTML = '<div style="color: white; text-align: center; padding-top: 50px;"><h2>No hi ha fitxers d\'estació disponibles</h2></div>';
                    updateStationCounter();
                    return;
                }
                
                const stationFile = stationFilesList[currentStationIndex];
                const fileExists = await checkFileExists(stationFile);
                
                if (fileExists) {
                    await loadCurrentStation();
                    return;
                }
            } while (currentStationIndex !== originalIndex);
        }

        // Funció per actualitzar el comptador (ARA basat en recompte REAL)
        async function updateStationCounter() {
            // Obtenir recompte REAL d'estacions disponibles
            if (availableStationsCount === 0) {
                availableStationsCount = await getAvailableStationsCount();
            }
            
            // Calcular la posició actual dins de les estacions disponibles
            let availablePosition = 1;
            let stationsFound = 0;
            
            for (let i = 0; i <= currentStationIndex; i++) {
                const stationFile = stationFilesList[i];
                const fileExists = await checkFileExists(stationFile);
                if (fileExists) {
                    stationsFound++;
                    if (i === currentStationIndex) {
                        availablePosition = stationsFound;
                    }
                }
            }
            
            // Mostrar el comptador: Posició dins disponibles / Total disponibles
            stationCounter.textContent = `${availablePosition}/${availableStationsCount}`;
        }

        // Funció per canviar a l'estació anterior
        async function prevStation() {
            const originalIndex = currentStationIndex;
            let attempts = 0;
            
            do {
                currentStationIndex = (currentStationIndex - 1 + stationFilesList.length) % stationFilesList.length;
                attempts++;
                
                // Si hem donat la volta completa, aturem
                if (attempts >= stationFilesList.length) {
                    currentStationIndex = originalIndex;
                    break;
                }
                
                const stationFile = stationFilesList[currentStationIndex];
                const fileExists = await checkFileExists(stationFile);
                
                if (fileExists) {
                    await loadCurrentStation();
                    return;
                }
            } while (currentStationIndex !== originalIndex);
        }

        // Funció per canviar a la següent estació
        async function nextStation() {
            await moveToNextAvailableStation();
        }

        // Funció per iniciar la rotació
        function startRotation() {
            if (rotationInterval) {
                clearInterval(rotationInterval);
            }
            
            rotationInterval = setInterval(async () => {
                if (isRotating) {
                    await nextStation();
                }
            }, rotationSpeed);
            
            statusSpan.textContent = `Rotant: ${rotationSpeed/1000}s`;
        }

        // Funció per aturar/iniciar la rotació
        function toggleRotation() {
            isRotating = !isRotating;
            rotationBtn.textContent = isRotating ? 'Aturar Rotació' : 'Iniciar Rotació';
            
            if (isRotating) {
                startRotation();
            } else {
                if (rotationInterval) {
                    clearInterval(rotationInterval);
                }
                statusSpan.textContent = 'Aturada';
            }
        }

        // Inicialització
        document.addEventListener('DOMContentLoaded', async function() {
            // Obtenir recompte REAL d'estacions disponibles
            availableStationsCount = await getAvailableStationsCount();
            console.log(`Estacions disponibles detectades: ${availableStationsCount}`);
            
            // Carregar la primera estació immediatament
            await loadCurrentStation();
            
            // Configurar esdeveniments
            prevBtn.addEventListener('click', prevStation);
            nextBtn.addEventListener('click', nextStation);
            rotationBtn.addEventListener('click', toggleRotation);
            
            // Configurar control de velocitat
            rotationSpeedInput.addEventListener('input', function() {
                rotationSpeed = this.value * 1000;
                if (isRotating) {
                    startRotation();
                }
                statusSpan.textContent = `Rotant: ${rotationSpeed/1000}s`;
            });
            
            // Iniciar rotació automàtica
            startRotation();
            
            // Afegir navegació amb teclat
            document.addEventListener('keydown', function(event) {
                if (event.key === 'ArrowLeft') {
                    prevStation();
                } else if (event.key === 'ArrowRight') {
                    nextStation();
                } else if (event.key === ' ') {
                    event.preventDefault();
                    toggleRotation();
                }
            });
        });
    </script>
</body>
</html>
